# üö® –°–†–û–ß–ù–û: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É 401

## üéØ –ü–†–û–ë–õ–ï–ú–ê
–û—à–∏–±–∫–∞ 401 "Your authentication token is not from a valid issuer" –±–ª–æ–∫–∏—Ä—É–µ—Ç —á–∞—Ç –Ω–∞ https://chatedem.com

---

## ‚ö° –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Vercel

1. –û—Ç–∫—Ä–æ–π: https://vercel.com/dashboard
2. –ù–∞–π–¥–∏ –ø—Ä–æ–µ–∫—Ç —Å –¥–æ–º–µ–Ω–æ–º `chatedem.com`
3. –û—Ç–∫—Ä–æ–π: Settings ‚Üí Environment Variables

### –ü—Ä–æ–≤–µ—Ä—å —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

#### –ö–†–ò–¢–ò–ß–ù–û - Supabase:
- ‚úÖ `NEXT_PUBLIC_SUPABASE_URL` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∏–ø–∞ `https://xxx.supabase.co`
- ‚úÖ `NEXT_PUBLIC_SUPABASE_ANON_KEY` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–ª–∏–Ω–Ω—ã–π –∫–ª—é—á (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `eyJ`)
- ‚úÖ `SUPABASE_SERVICE_ROLE_KEY` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–ª–∏–Ω–Ω—ã–π –∫–ª—é—á (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `eyJ`)

**–í–ê–ñ–ù–û:** 
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` ‚Äî —ç—Ç–æ **anon/public key** –∏–∑ Supabase (–ù–ï service role!)
- `SUPABASE_SERVICE_ROLE_KEY` ‚Äî —ç—Ç–æ **service_role key** –∏–∑ Supabase

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–π:

1. –û—Ç–∫—Ä–æ–π: https://supabase.com/dashboard
2. –ù–∞–π–¥–∏ –ø—Ä–æ–µ–∫—Ç (URL –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `NEXT_PUBLIC_SUPABASE_URL`)
3. –û—Ç–∫—Ä–æ–π: Settings ‚Üí API
4. –ü—Ä–æ–≤–µ—Ä—å:
   - **Project URL** ‚Üí –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `NEXT_PUBLIC_SUPABASE_URL`
   - **anon/public key** ‚Üí –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - **service_role key** ‚Üí –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `SUPABASE_SERVICE_ROLE_KEY`

**–ï—Å–ª–∏ –∫–ª—é—á–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç:**
- –°–∫–æ–ø–∏—Ä—É–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –∏–∑ Supabase
- –û–±–Ω–æ–≤–∏ –Ω–∞ Vercel
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø–µ—Ä–µ–¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç!**

---

## ‚ö° –®–ê–ì 2: –ü–µ—Ä–µ–¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

1. Vercel Dashboard ‚Üí Deployments
2. –ù–∞–π–¥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π
3. –ù–∞–∂–º–∏ "Redeploy" (–∏–ª–∏ —Å–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –∫–æ–º–º–∏—Ç –∏ –∑–∞–ø—É—à—å)

**–ò–ª–∏ —á–µ—Ä–µ–∑ Git:**
```bash
git commit --allow-empty -m "Trigger redeploy"
git push origin main
```

---

## ‚ö° –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Vercel

1. Vercel Dashboard ‚Üí Functions ‚Üí Logs
2. –û—Ç–ø—Ä–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –Ω–∞ —Å–∞–π—Ç–µ
3. –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- –û—à–∏–±–∫–∏ "Invalid JWT" –∏–ª–∏ "token is not from a valid issuer"
- –û—à–∏–±–∫–∏ "NEXT_PUBLIC_SUPABASE_ANON_KEY is not defined"
- –û—à–∏–±–∫–∏ "SUPABASE_SERVICE_ROLE_KEY is not defined"

**–ï—Å–ª–∏ –≤–∏–¥–∏—à—å –æ—à–∏–±–∫—É –ø—Ä–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–∏—Ç—å –ø—Ä–æ–µ–∫—Ç

---

## ‚ö° –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

**–§–∞–π–ª:** `src/app/api/chat/stream/route.ts`

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```typescript
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;

// –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º anon key:
const supabaseAuth = createClient(supabaseUrl, supabaseAnonKey);
const { data: { user }, error: authError } = await supabaseAuth.auth.getUser(token);
```

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
const supabaseAuth = createClient(supabaseUrl, supabaseServiceKey);
```

---

## ‚ö° –®–ê–ì 5: –ü—Ä–æ–≤–µ—Ä—å —Ç–æ–∫–µ–Ω –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

**–§–∞–π–ª:** `src/app/page.tsx`

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```typescript
const { data: { session }, error: sessionError } = await supabase.auth.getSession();
if (sessionError || !session) {
  // –æ—à–∏–±–∫–∞
}
if (!session.access_token) {
  // –æ—à–∏–±–∫–∞
}

// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω:
Authorization: `Bearer ${session.access_token}`
```

**–ü—Ä–æ–≤–µ—Ä—å:**
- –¢–æ–∫–µ–Ω –Ω–µ –ø—É—Å—Ç–æ–π?
- –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ?

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "token is not from a valid issuer":

**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Å—å, —á—Ç–æ `NEXT_PUBLIC_SUPABASE_ANON_KEY` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (anon key –∏–∑ Supabase)
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `supabaseAnonKey` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞
3. –ü–µ—Ä–µ–¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç

### –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "NEXT_PUBLIC_SUPABASE_ANON_KEY is not defined":

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ Vercel
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–ª—è Production
3. –ü–µ—Ä–µ–¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç

### –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –ø—É—Å—Ç–æ–π:

**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞ –∏–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –í—ã–π–¥–∏ –∏ –≤–æ–π–¥–∏ —Å–Ω–æ–≤–∞
2. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–≤—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞—é—Ç
3. –ü—Ä–æ–≤–µ—Ä—å cookies –≤ –±—Ä–∞—É–∑–µ—Ä–µ

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢

- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ Vercel
- [ ] –ö–ª—é—á–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å Supabase
- [ ] –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `supabaseAnonKey` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞
- [ ] –ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–¥–µ–ø–ª–æ–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ –æ—à–∏–±–∫–∏
- [ ] –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —Å –∫–ª–∏–µ–Ω—Ç–∞

---

## üöÄ –ù–ê–ß–ù–ò –° –®–ê–ì–ê 1!

–°–∞–º—ã–π —á–∞—Å—Ç—ã–π —Å–ª—É—á–∞–π ‚Äî –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Vercel. –ü—Ä–æ–≤–µ—Ä—å –∏—Ö –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º!

