# üîß –§–ò–ù–ê–õ–¨–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–º–µ—á–∞–Ω–∏–π

## üéØ –¶–ï–õ–¨

–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥–≤–∞ –∑–∞–º–µ—á–∞–Ω–∏—è –∏–∑ –æ—Ç—á—ë—Ç–∞:

1. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `billing_subscriptions` –≤ Supabase
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## ‚ö° –®–ê–ì 1: –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É billing_subscriptions

### –ü—Ä–æ–≤–µ—Ä–∫–∞: –ï—Å—Ç—å –ª–∏ —Ç–∞–±–ª–∏—Ü–∞?

1. –û—Ç–∫—Ä–æ–π: <https://supabase.com/dashboard>
2. –ù–∞–π–¥–∏ –ø—Ä–æ–µ–∫—Ç (URL –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `NEXT_PUBLIC_SUPABASE_URL` –∏–∑ Vercel)
3. –û—Ç–∫—Ä–æ–π: Table Editor
4. –ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ `billing_subscriptions`

**–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –ù–ï–¢:**

### –†–µ—à–µ–Ω–∏–µ: –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

1. –û—Ç–∫—Ä–æ–π: Supabase Dashboard ‚Üí SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π –∏ –≤—ã–ø–æ–ª–Ω–∏ —ç—Ç–æ—Ç SQL –∫–æ–¥:

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã billing_subscriptions
CREATE TABLE IF NOT EXISTS public.billing_subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES public.profiles(id) ON DELETE CASCADE,
  plan TEXT NOT NULL CHECK (plan IN ('basic', 'plus', 'pro')),
  status TEXT NOT NULL DEFAULT 'inactive',
  stripe_customer_id TEXT,
  stripe_subscription_id TEXT,
  yookassa_payment_id TEXT,
  crypto_payment_id TEXT,
  current_period_end TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ user_id
CREATE UNIQUE INDEX IF NOT EXISTS billing_subscriptions_user_id_idx
ON public.billing_subscriptions(user_id);

-- –í–∫–ª—é—á–∞–µ–º RLS
ALTER TABLE public.billing_subscriptions ENABLE ROW LEVEL SECURITY;

-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
DROP POLICY IF EXISTS "Users can view own subscriptions" ON public.billing_subscriptions;
DROP POLICY IF EXISTS "Users can update own subscriptions" ON public.billing_subscriptions;
DROP POLICY IF EXISTS "Users can insert own subscriptions" ON public.billing_subscriptions;

-- –ü–æ–ª–∏—Ç–∏–∫–∏ RLS
CREATE POLICY "Users can view own subscriptions"
  ON public.billing_subscriptions FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can update own subscriptions"
  ON public.billing_subscriptions FOR UPDATE
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own subscriptions"
  ON public.billing_subscriptions FOR INSERT
  WITH CHECK (auth.uid() = user_id);

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
CREATE OR REPLACE FUNCTION public.set_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è updated_at
DROP TRIGGER IF EXISTS set_billing_subscription_updated_at ON public.billing_subscriptions;
CREATE TRIGGER set_billing_subscription_updated_at
  BEFORE UPDATE ON public.billing_subscriptions
  FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();
```

3. –ù–∞–∂–º–∏ "Run" (–∏–ª–∏ F5)
4. –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   - ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "Success. No rows returned"
   - ‚úÖ –ò–ª–∏ "Success" —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Å—Ç—Ä–æ–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π: Table Editor
2. –ü—Ä–æ–≤–µ—Ä—å:
   - ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `billing_subscriptions` –ø–æ—è–≤–∏–ª–∞—Å—å?
   - ‚úÖ –ï—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∏: `id`, `user_id`, `plan`, `status`, `created_at`, `updated_at`?

**–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –£–ñ–ï –ï–°–¢–¨:**

–ü—Ä–æ–≤–µ—Ä—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

1. –û—Ç–∫—Ä–æ–π —Ç–∞–±–ª–∏—Ü—É `billing_subscriptions`
2. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–ª–æ–Ω–∫–∏:
   - ‚úÖ `id` (UUID, PRIMARY KEY)
   - ‚úÖ `user_id` (UUID, —Å—Å—ã–ª–∫–∞ –Ω–∞ profiles)
   - ‚úÖ `plan` (TEXT, –∑–Ω–∞—á–µ–Ω–∏—è: 'basic', 'plus', 'pro')
   - ‚úÖ `status` (TEXT, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'inactive')
   - ‚úÖ `created_at` (TIMESTAMPTZ)
   - ‚úÖ `updated_at` (TIMESTAMPTZ)

–ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è ‚Äî –≤—ã–ø–æ–ª–Ω–∏ SQL –≤—ã—à–µ (–æ–Ω –±–µ–∑–æ–ø–∞—Å–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IF NOT EXISTS`).

---

## ‚ö° –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞

### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:

- `LocaleContext` (React Context)
- `localStorage` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞
- –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞

**–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è!** –ù–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –¥–ª—è SEO.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –û—Ç–∫—Ä–æ–π: <https://chatedem.com>
2. –ü—Ä–æ–≤–µ—Ä—å:
   - ‚úÖ –ï—Å—Ç—å –ª–∏ –∫–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞ (RU/EN)?
   - ‚úÖ –ü—Ä–∏ –∫–ª–∏–∫–µ —è–∑—ã–∫ –º–µ–Ω—è–µ—Ç—Å—è?
   - ‚úÖ –í—ã–±–æ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏?

**–ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:**

### –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥

1. –ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª: `src/components/LanguageSwitcher.tsx`
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç: `import { useLocale } from '@/contexts/LocaleContext';`
   - –î–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å: `const { locale, setLocale } = useLocale();`

2. –ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª: `src/app/layout.tsx`
   - –î–æ–ª–∂–µ–Ω –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å children –≤ `<LocaleProvider>`

3. –ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª: `src/contexts/LocaleContext.tsx`
   - –î–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ `localStorage`
   - –î–æ–ª–∂–µ–Ω –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —è–∑—ã–∫ –±—Ä–∞—É–∑–µ—Ä–∞

**–ï—Å–ª–∏ –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

–í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å:

- –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `<LanguageSwitcher />`?
- –ï—Å—Ç—å –ª–∏ –æ–Ω –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ?

---

## ‚ö° –®–ê–ì 3: –£–ª—É—á—à–µ–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è SEO

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `/en` –∏ `/ru` –≤ URL, –Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—á–µ—Ä–µ–∑ localStorage) ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è!**

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

1. –û–±–Ω–æ–≤–∏—Ç—å `src/contexts/LocaleContext.tsx`:
   - –ß–∏—Ç–∞—Ç—å `locale` –∏–∑ URL (–µ—Å–ª–∏ –µ—Å—Ç—å `/en` –∏–ª–∏ `/ru`)
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ `localStorage`
   - –û–±–Ω–æ–≤–ª—è—Ç—å URL –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏

2. –û–±–Ω–æ–≤–∏—Ç—å `src/middleware.ts`:
   - –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å `/en` –∏ `/ru` –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–∫–∞–ª—å—é

**–ù–æ —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!** –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ü–†–û–í–ï–†–ö–ò

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:

- [ ] –¢–∞–±–ª–∏—Ü–∞ `billing_subscriptions` —Å–æ–∑–¥–∞–Ω–∞ –≤ Supabase
- [ ] –¢–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í—ã–±–æ—Ä —è–∑—ã–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üéØ –ò–¢–û–ì–û–í–´–ô –û–¢–ß–Å–¢

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–æ–∑–¥–∞–π –æ—Ç—á—ë—Ç:

```markdown
# –û—Ç—á—ë—Ç –æ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö

**–î–∞—Ç–∞:** [–¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è]
**–ê–≥–µ–Ω—Ç:** –ò–ò-–∞–≥–µ–Ω—Ç

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏:
- [x] –®–ê–ì 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã billing_subscriptions
- [x] –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞
- [x] –®–ê–ì 3: –£–ª—É—á—à–µ–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:

### –¢–∞–±–ª–∏—Ü–∞ billing_subscriptions:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞: [–¥–∞/–Ω–µ—Ç]
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è: [–¥–∞/–Ω–µ—Ç]
- ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã: [–¥–∞/–Ω–µ—Ç]

### –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞:
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ: [–¥–∞/–Ω–µ—Ç]
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ: [–¥–∞/–Ω–µ—Ç]
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤—ã–±–æ—Ä: [–¥–∞/–Ω–µ—Ç]

## –°—Ç–∞—Ç—É—Å:
- ‚úÖ –í—Å–µ –∑–∞–º–µ—á–∞–Ω–∏—è —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ
```

---

## üöÄ –ù–ê–ß–ù–ò –° –®–ê–ì–ê 1

–í—ã–ø–æ–ª–Ω—è–π —à–∞–≥–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ.
