# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ó–ê–î–ê–ß–ê: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É 401 –≤ —á–∞—Ç–µ EDEM

## üìã –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê

**–ü—Ä–æ–µ–∫—Ç:** EDEM Intelligence ‚Äî AI-—á–∞—Ç —Å –ø—è—Ç—å—é –≥–æ–ª–æ—Å–∞–º–∏ (–ñ–∏–≤–æ–π, –¢–µ–Ω—å, –ó–µ—Ä–∫–∞–ª–æ, –†–µ–±—ë–Ω–æ–∫, –ú—É–¥—Ä–µ—Ü)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Next.js 14 (App Router)
- Supabase (auth, database, RLS)
- OpenAI GPT-4o-mini (AI responses)
- Vercel (–¥–µ–ø–ª–æ–π)
- YooKassa (–ø–ª–∞—Ç–µ–∂–∏ –¥–ª—è –†–æ—Å—Å–∏–∏)
- –î–æ–º–µ–Ω: https://chatedem.com

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
```
ai-chat-pro/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx              # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —á–∞—Ç–æ–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ stream/
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ route.ts  # API –¥–ª—è —á–∞—Ç–∞ (SSE, –∫—Ä–∏—Ç–∏—á–Ω–æ!)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ signup/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ account/
‚îÇ   ‚îî‚îÄ‚îÄ lib/
‚îÇ       ‚îú‚îÄ‚îÄ supabase.ts           # Supabase –∫–ª–∏–µ–Ω—Ç (client-side)
‚îÇ       ‚îú‚îÄ‚îÄ prompts.ts            # –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è –≥–æ–ª–æ—Å–æ–≤
‚îÇ       ‚îî‚îÄ‚îÄ edem-orchestra.ts     # –ê–≤—Ç–æ-–≤—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞
‚îú‚îÄ‚îÄ PROJECT_REPORT.md             # –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç –æ –ø—Ä–æ–µ–∫—Ç–µ
‚îú‚îÄ‚îÄ DEBUG_401.md                  # –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–∫–∏ 401
‚îî‚îÄ‚îÄ .env.local                    # –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–Ω–µ –≤ Git!)
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- 5 –≥–æ–ª–æ—Å–æ–≤ –ò–ò —Å —Ä–∞–∑–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞–º–∏
- Paywall –ø–æ—Å–ª–µ 2 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (RU/EN)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞ (EDEM ORCHESTRA)
- Streaming –æ—Ç–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ SSE

**–í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è:**
- `PROJECT_REPORT.md` ‚Äî –ø–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç –æ –ø—Ä–æ–µ–∫—Ç–µ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î, API endpoints
- `DEBUG_401.md` ‚Äî –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–∫–∏ 401
- `TASK_FOR_AI_AGENT_FIX_401_URGENT.md` ‚Äî –ø—Ä–µ–¥—ã–¥—É—â–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê

**–û—à–∏–±–∫–∞:** 401 "Your authentication token is not from a valid issuer"

**–ì–¥–µ:** –ù–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (chatedem.com) –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç

**–ö–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è/–≤—Ö–æ–¥–∏—Ç ‚úÖ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç ‚ùå
- API `/api/chat/stream` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401

**–°—Ç–∞—Ç—É—Å:** 
- ‚úÖ –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `supabaseAnonKey` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞)
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏ –∑–∞–ø—É—à–µ–Ω—ã –≤ Git
- ‚úÖ Vercel –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å
- ‚ùå –û—à–∏–±–∫–∞ –≤—Å—ë –µ—â—ë –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

**–ß—Ç–æ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ:**
1. `src/app/api/chat/stream/route.ts` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `supabaseAnonKey` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ (–Ω–µ `supabaseServiceKey`)
2. `src/app/page.tsx` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `getUser()` –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
3. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ –ö–†–ò–¢–ò–ß–ù–û ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–∞–π—Ç–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!

**–í–µ—Ä–æ—è—Ç–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. **90% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Vercel (anon key = service role key)
2. **8% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫ –∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
3. **2% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ü—Ä–æ–±–ª–µ–º–∞ —Å Supabase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

---

## üéØ –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨

### –®–ê–ì 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

#### 1.1 –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Vercel

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û—Ç–∫—Ä–æ–π: https://vercel.com/dashboard
2. –ù–∞–π–¥–∏ –ø—Ä–æ–µ–∫—Ç —Å –¥–æ–º–µ–Ω–æ–º `chatedem.com`
3. –û—Ç–∫—Ä–æ–π: Settings ‚Üí Environment Variables

**–ü—Ä–æ–≤–µ—Ä—å –Ω–∞–ª–∏—á–∏–µ —ç—Ç–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:**
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY`
- `OPENAI_API_KEY`

**–ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–π:**
1. –û—Ç–∫—Ä–æ–π: https://supabase.com/dashboard
2. –ù–∞–π–¥–∏ –ø—Ä–æ–µ–∫—Ç (URL –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `NEXT_PUBLIC_SUPABASE_URL`)
3. –û—Ç–∫—Ä–æ–π: Settings ‚Üí API
4. –°—Ä–∞–≤–Ω–∏ –∫–ª—é—á–∏:
   - **anon/public key** ‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - **service_role key** ‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `SUPABASE_SERVICE_ROLE_KEY`

**–ï—Å–ª–∏ –∫–ª—é—á–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç:**
- –°–∫–æ–ø–∏—Ä—É–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –∏–∑ Supabase
- –û–±–Ω–æ–≤–∏ –Ω–∞ Vercel
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø–µ—Ä–µ–¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç!**

#### 1.2 –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Vercel

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û—Ç–∫—Ä–æ–π: Vercel Dashboard ‚Üí Functions ‚Üí Logs
2. –û—Ç–ø—Ä–∞–≤—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –Ω–∞ chatedem.com
3. –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- –û—à–∏–±–∫–∏ "Invalid JWT" –∏–ª–∏ "token is not from a valid issuer"
- –û—à–∏–±–∫–∏ "NEXT_PUBLIC_SUPABASE_ANON_KEY is not defined"
- –û—à–∏–±–∫–∏ "SUPABASE_SERVICE_ROLE_KEY is not defined"
- –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ó–∞–ø–∏—à–∏:**
- –¢–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
- –°—Ç–µ–∫ —Ç—Ä–µ–π—Å (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –í—Ä–µ–º—è –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è

#### 1.3 –ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–§–∞–π–ª:** `src/app/api/chat/stream/route.ts`

**–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

```typescript
// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;

// –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º anon key:
const supabaseAuth = createClient(supabaseUrl, supabaseAnonKey);
const { data: { user }, error: authError } = await supabaseAuth.auth.getUser(token);
```

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
const supabaseAuth = createClient(supabaseUrl, supabaseServiceKey);
```

**–ü—Ä–æ–≤–µ—Ä—å:**
- –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `supabaseAnonKey` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞?
- –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `supabaseServiceKey` —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö?

#### 1.4 –ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

**–§–∞–π–ª:** `src/app/page.tsx`

**–ü—Ä–æ–≤–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏—é `handleSend`:**

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```typescript
// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç —Ç–æ–∫–µ–Ω –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
const { data: { user }, error: userError } = await supabase.auth.getUser();
if (userError || !user) {
  // –æ—à–∏–±–∫–∞
}

// –ü–æ–ª—É—á–∞–µ–º —Å–µ—Å—Å–∏—é
let { data: { session }, error: sessionError } = await supabase.auth.getSession();
if (!session) {
  // –ø—Ä–æ–±—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å
  const { data: { session: refreshed } } = await supabase.auth.refreshSession();
  session = refreshed;
}

// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω
Authorization: `Bearer ${session.access_token}`
```

**–ü—Ä–æ–≤–µ—Ä—å:**
- –¢–æ–∫–µ–Ω –Ω–µ –ø—É—Å—Ç–æ–π?
- –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization`?

---

### –®–ê–ì 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 2.1 –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û–±–Ω–æ–≤–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ Vercel –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏–∑ Supabase
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–ª—è **Production** –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ü–µ—Ä–µ–¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç:
   - Vercel Dashboard ‚Üí Deployments ‚Üí Redeploy
   - –ò–ª–∏ —á–µ—Ä–µ–∑ Git: `git commit --allow-empty -m "Redeploy" && git push`

#### 2.2 –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ

**–ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª:** `src/app/api/chat/stream/route.ts`

**–£–±–µ–¥–∏—Å—å, —á—Ç–æ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `supabaseAnonKey` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `supabaseServiceKey` —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ï—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
1. –í–Ω–µ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥
2. –ó–∞–∫–æ–º–º–∏—Ç—å: `git add . && git commit -m "Fix: 401 auth error" && git push`

#### 2.3 –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–∫–µ–Ω–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

**–ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª:** `src/app/page.tsx`

**–£–±–µ–¥–∏—Å—å, —á—Ç–æ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `getUser()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- –ï—Å—Ç—å fallback –Ω–∞ `refreshSession()` –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫
- –¢–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

**–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
1. –í–Ω–µ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥
2. –ó–∞–∫–æ–º–º–∏—Ç—å: `git add . && git commit -m "Fix: Token refresh handling" && git push`

---

### –®–ê–ì 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 3.1 –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –£–±–µ–¥–∏—Å—å, —á—Ç–æ `.env.local` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
2. –ó–∞–ø—É—Å—Ç–∏: `npm run dev`
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è / –≤–æ–π–¥–∏
4. –û—Ç–ø—Ä–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
5. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –æ—à–∏–±–∫–∏ 401 –Ω–µ—Ç

#### 3.2 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü–æ–¥–æ–∂–¥–∏ 2-3 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
2. –û—Ç–∫—Ä–æ–π: https://chatedem.com
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è / –≤–æ–π–¥–∏
4. –û—Ç–ø—Ä–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
5. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –Ω–∞ –æ—à–∏–±–∫–∏
6. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Vercel

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- ‚úÖ –ò–ò –æ—Ç–≤–µ—á–∞–µ—Ç
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ 401 –≤ –∫–æ–Ω—Å–æ–ª–∏
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö Vercel

---

### –®–ê–ì 4: –û—Ç—á—ë—Ç

**–°–æ–∑–¥–∞–π —Ñ–∞–π–ª:** `FIX_401_REPORT.md`

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
1. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
   - –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
   - –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   - –õ–æ–≥–∏ –æ—à–∏–±–æ–∫ (–µ—Å–ª–∏ –µ—Å—Ç—å)

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
   - –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ
   - –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã
   - –ö–æ–º–º–∏—Ç—ã (—Ö–µ—à–∏)

3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
   - –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
   - –û—Å—Ç–∞–ª–∏—Å—å –ª–∏ –ø—Ä–æ–±–ª–µ–º—ã

4. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
   - –ß—Ç–æ –µ—â—ë –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å
   - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –±—É–¥—É—â–µ–º

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ß–ï–°–ö–ò–ï –ö–û–ú–ê–ù–î–´

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
cd /Users/sanecek/tema/ai-chat-pro
cat .env.local | grep SUPABASE
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫–æ–º–º–∏—Ç–æ–≤:

```bash
git log --oneline -5
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Git:

```bash
git status
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –Ω–∞ –æ—à–∏–±–∫–∏:

```bash
npm run build
```

---

## üìù –í–ê–ñ–ù–´–ï –§–ê–ô–õ–´

**–ö–æ–¥:**
- `src/app/api/chat/stream/route.ts` ‚Äî API –¥–ª—è —á–∞—Ç–∞
- `src/app/page.tsx` ‚Äî –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —á–∞—Ç–æ–º
- `src/lib/supabase.ts` ‚Äî Supabase –∫–ª–∏–µ–Ω—Ç

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `DEBUG_401.md` ‚Äî –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–∫–∏ 401
- `TASK_FOR_AI_AGENT_FIX_401_URGENT.md` ‚Äî –ø—Ä–µ–¥—ã–¥—É—â–∞—è –∑–∞–¥–∞—á–∞
- `PROJECT_REPORT.md` ‚Äî –æ–±—â–∏–π –æ—Ç—á—ë—Ç –æ –ø—Ä–æ–µ–∫—Ç–µ

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢

- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ Vercel
- [ ] –ö–ª—é—á–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å Supabase
- [ ] –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `supabaseAnonKey` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞
- [ ] –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `getUser()` –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- [ ] –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ –æ—à–∏–±–∫–∏
- [ ] –ü—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–¥–µ–ø–ª–æ–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- [ ] –ü—Ä–æ–¥–∞–∫—à–µ–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- [ ] –û—Ç—á—ë—Ç —Å–æ–∑–¥–∞–Ω

---

## üöÄ –ù–ê–ß–ù–ò –° –®–ê–ì–ê 1.1

**–°–∞–º—ã–π —á–∞—Å—Ç—ã–π —Å–ª—É—á–∞–π ‚Äî –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Vercel.**

**–ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π:**
1. –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ Vercel (–®–ê–ì 1.1)
2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Vercel (–®–ê–ì 1.2)
3. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞–π–¥–µ–Ω–∞ ‚Äî –∏—Å–ø—Ä–∞–≤—å (–®–ê–ì 2)
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π (–®–ê–ì 3)
5. –°–æ–∑–¥–∞–π –æ—Ç—á—ë—Ç (–®–ê–ì 4)

---

## üí° –ü–û–î–°–ö–ê–ó–ö–ò

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "token is not from a valid issuer":**
- –ü—Ä–æ–±–ª–µ–º–∞ –≤ `NEXT_PUBLIC_SUPABASE_ANON_KEY` ‚Äî –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —ç—Ç–æ anon key, –∞ –Ω–µ service role key

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "NEXT_PUBLIC_SUPABASE_ANON_KEY is not defined":**
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –Ω–∞ Vercel ‚Äî –¥–æ–±–∞–≤—å –∏ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–π

**–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –ø—É—Å—Ç–æ–π:**
- –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π `getUser()` –∏–ª–∏ `refreshSession()`

**–ï—Å–ª–∏ –≤—Å—ë –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, –Ω–æ –æ—à–∏–±–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è:**
- –ü–æ–¥–æ–∂–¥–∏ 2-3 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- –û—á–∏—Å—Ç–∏ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞
- –í—ã–π–¥–∏ –∏ –≤–æ–π–¥–∏ —Å–Ω–æ–≤–∞

---

## üìû –ï–°–õ–ò –ù–ï –ü–û–ú–û–ì–õ–û

**–°–æ–±–µ—Ä–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:**
1. –°–∫—Ä–∏–Ω—à–æ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Vercel (—Å–∫—Ä–æ–π –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–æ –ø–æ–∫–∞–∂–∏ –Ω–∞–∑–≤–∞–Ω–∏—è)
2. –õ–æ–≥–∏ –∏–∑ Vercel Functions (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫)
3. –û—à–∏–±–∫—É –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console)
4. –†–µ–∑—É–ª—å—Ç–∞—Ç `git log --oneline -5`

**–°–æ–∑–¥–∞–π —Ñ–∞–π–ª:** `FIX_401_FAILED.md` —Å —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

---

**–£–¥–∞—á–∏! –ò—Å–ø—Ä–∞–≤—å —ç—Ç—É –æ—à–∏–±–∫—É –∏ –≤–µ—Ä–Ω–∏ —á–∞—Ç –≤ —Ä–∞–±–æ—á–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ! üöÄ**

